---
# Ansible переменные для развертывания MLOps проекта
# Файл: vars-main.yml
#
# Этот файл содержит все настраиваемые параметры для развертывания

# ==============================================================================
# ОСНОВНЫЕ НАСТРОЙКИ
# ==============================================================================

# Пользователь для запуска сервиса
mlops_user: mlops
mlops_group: mlops

# Домашняя директория пользователя
mlops_home: /opt/mlops

# Порт для REST API
mlops_port: 8000

# Хост для привязки (0.0.0.0 - все интерфейсы, 127.0.0.1 - только локально)
mlops_host: "0.0.0.0"

# ==============================================================================
# НАСТРОЙКИ ПРИЛОЖЕНИЯ
# ==============================================================================

# Версия приложения
app_version: "1.0.0"

# Уровень логирования (DEBUG, INFO, WARNING, ERROR, CRITICAL)
log_level: INFO

# Путь к файлу логов
log_file: "{{ mlops_home }}/logs/mlops.log"

# Максимальный размер файла лога (в байтах)
log_max_bytes: 10485760  # 10MB

# Количество файлов бэкапов логов
log_backup_count: 5

# ==============================================================================
# НАСТРОЙКИ ML МОДЕЛИ
# ==============================================================================

# Путь к файлу модели
model_path: "{{ mlops_home }}/app/model.pkl"

# Параметры модели Random Forest
rf_n_estimators: 100
rf_max_depth: 5
rf_random_state: 42

# Размер тестовой выборки (0.0 - 1.0)
test_size: 0.2

# ==============================================================================
# НАСТРОЙКИ МОНИТОРИНГА
# ==============================================================================

# Директория для отчетов
reports_dir: "{{ mlops_home }}/reports"

# Минимальное количество данных для анализа дрейфа
drift_min_samples: 10

# Максимальный размер буфера данных для мониторинга
monitoring_buffer_size: 10000

# Порог для обнаружения дрейфа (p-value)
drift_threshold: 0.05

# ==============================================================================
# НАСТРОЙКИ ПРОИЗВОДИТЕЛЬНОСТИ
# ==============================================================================

# Количество worker процессов для uvicorn
# Рекомендуется: (2 * CPU_CORES) + 1
workers: 4

# Таймаут для graceful shutdown (секунды)
graceful_timeout: 30

# Максимальное количество одновременных запросов
max_requests: 1000

# ==============================================================================
# НАСТРОЙКИ БЕЗОПАСНОСТИ
# ==============================================================================

# Включить firewall (UFW)
enable_firewall: true

# Разрешенные CORS origins (для production указать конкретные домены)
cors_origins:
  - "http://localhost:3000"
  - "http://localhost:8080"

# Включить HTTPS (требуется SSL сертификат)
enable_https: false

# Пути к SSL сертификатам (если enable_https: true)
ssl_cert_path: /etc/ssl/certs/mlops.crt
ssl_key_path: /etc/ssl/private/mlops.key

# ==============================================================================
# НАСТРОЙКИ MLFLOW
# ==============================================================================

# Директория для MLflow artifacts
mlflow_artifacts_dir: "{{ mlops_home }}/mlruns"

# URI для tracking server (file:// для локального хранения)
mlflow_tracking_uri: "file://{{ mlflow_artifacts_dir }}"

# Имя эксперимента MLflow
mlflow_experiment_name: "iris_classification"

# ==============================================================================
# НАСТРОЙКИ РЕЗЕРВНОГО КОПИРОВАНИЯ
# ==============================================================================

# Включить автоматическое резервное копирование
enable_backup: true

# Директория для бэкапов
backup_dir: "{{ mlops_home }}/backups"

# Расписание бэкапов (cron format)
backup_schedule: "0 2 * * *"  # Каждый день в 2:00 AM

# Количество дней хранения бэкапов
backup_retention_days: 7

# ==============================================================================
# НАСТРОЙКИ СИСТЕМНЫХ РЕСУРСОВ
# ==============================================================================

# Ограничения памяти для процесса (в MB, 0 = без ограничений)
memory_limit: 512

# Ограничение CPU (доля от 1 CPU, например 0.5 = 50%)
cpu_limit: 1.0

# ==============================================================================
# НАСТРОЙКИ HEALTH CHECK
# ==============================================================================

# Интервал между health checks (секунды)
health_check_interval: 30

# Таймаут для health check (секунды)
health_check_timeout: 10

# Количество неудачных попыток до перезапуска
health_check_retries: 3

# ==============================================================================
# ПЕРЕМЕННЫЕ ОКРУЖЕНИЯ
# ==============================================================================

# Дополнительные переменные окружения для приложения
environment_vars:
  PYTHONUNBUFFERED: "1"
  PYTHONDONTWRITEBYTECODE: "1"
  TZ: "UTC"

# ==============================================================================
# НАСТРОЙКИ РАЗВЕРТЫВАНИЯ
# ==============================================================================

# Таймаут для загрузки зависимостей (секунды)
pip_install_timeout: 600

# Использовать pip cache
pip_cache_enabled: true

# Дополнительные pip опции
pip_extra_args: "--no-cache-dir"

# Автоматически обучить модель при развертывании
auto_train_model: true

# Запустить тесты после развертывания
run_tests_after_deploy: false

# ==============================================================================
# НАСТРОЙКИ МЕТРИК И МОНИТОРИНГА
# ==============================================================================

# Включить экспорт метрик для Prometheus
enable_prometheus: false

# Порт для метрик Prometheus
prometheus_port: 9090

# Путь к метрикам
metrics_path: "/metrics"

# ==============================================================================
# НАСТРОЙКИ НАГРУЗОЧНОГО ТЕСТИРОВАНИЯ
# ==============================================================================

# Параметры Locust для автоматического тестирования
locust_users: 10
locust_spawn_rate: 2
locust_run_time: "1m"

# ==============================================================================
# НАСТРОЙКИ УВЕДОМЛЕНИЙ
# ==============================================================================

# Email для уведомлений (пусто = отключено)
notification_email: ""

# Webhook URL для уведомлений (пусто = отключено)
notification_webhook: ""

# ==============================================================================
# ПРИМЕЧАНИЯ
# ==============================================================================
#
# 1. Для production окружения измените:
#    - mlops_host на конкретный IP или используйте reverse proxy
#    - enable_https на true и настройте SSL сертификаты
#    - cors_origins на конкретные домены
#    - log_level на WARNING или ERROR
#
# 2. Для высоконагруженных систем:
#    - Увеличьте workers до (2 * CPU_CORES) + 1
#    - Увеличьте memory_limit
#    - Настройте мониторинг с Prometheus
#
# 3. Безопасность:
#    - Всегда используйте firewall в production
#    - Регулярно обновляйте зависимости
#    - Настройте резервное копирование
#
# ==============================================================================
